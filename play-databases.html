<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="author" content="Poon" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="主流数据库安装、维护、开发与管理"/>
    <meta property="og:url" content="http://www.imx3.com/play-databases.html"/>
    <meta property="og:site_name" content="仗梦天涯&nbsp;&nbsp;&nbsp;&nbsp;倚霞而栖"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="http://www.imx3.com/play-databases.html" />

    <title>主流数据库安装、维护、开发与管理 | 仗梦天涯&nbsp;&nbsp;&nbsp;&nbsp;倚霞而栖</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="http://www.imx3.com/theme/css/main.css" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "7470bcd0-1833-4a2b-a25f-c4a233bdfced",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">

<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h2>
                        <a href="http://www.imx3.com/"> 仗梦天涯&nbsp;&nbsp;&nbsp;&nbsp;倚霞而栖 </a> 
<!-- /# 
 
                        <strong>
                            <span style="font-size:12px;vertical-align:bottom">Be a Coder,Lifehacker,Storyteller </span>
                        </strong>
 -->
                </h2>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li ><a href="tags.html">Tags</a></li>
                            <li ><a href="about.html">About</a></li>
                        </ul>

<script>
  (function() {
    var cx = '005973619447881484970:jf4jwrpc3tg';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div id="google-custom-search" class="nav">
    <gcse:search></gcse:search>
</div>
                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="http://www.imx3.com/play-databases.html" rel="bookmark"
             title="Permalink to 主流数据库安装、维护、开发与管理">主流数据库安装、维护、开发与管理</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="http://www.imx3.com/author/poon.html">Poon</a>
    </address>

    in <a href="http://www.imx3.com/category/tech.html">Tech</a>

    on 2015-12-11

        |
        tags:         <a href="http://www.imx3.com/tag/db.html">DB</a>
        <a href="http://www.imx3.com/tag/database.html">database</a>
        <a href="http://www.imx3.com/tag/shu-ju-ku.html">数据库</a>
        <a href="http://www.imx3.com/tag/db2.html">db2</a>
        <a href="http://www.imx3.com/tag/oracle.html">oracle</a>
        <a href="http://www.imx3.com/tag/mysql.html">mysql</a>


        |
        <a href="http://www.imx3.com/play-databases.html#disqus_thread">comments</a>

    
</footer><!-- /.post-info -->
        <div class="sharethis-top">
          <span class='st_fblike_hcount' displayText='Facebook Like'></span>
          <span class='st_plusone_hcount' displayText='Google +1'></span>
          <span class='st_twitter_hcount' displayText='Tweet'></span>
          <span class='st_email_hcount' displayText='Email'></span>
        </div>

        <nav class="toc">
        <div class="toc">
<ul>
<li><a href="#db2">DB2</a><ul>
<li><a href="#_1">启动&amp;连接&amp;测试</a></li>
<li><a href="#_2">密码带特殊字符时，如果连接</a></li>
<li><a href="#sql3001c-an-io-error">SQL3001C  An I/O error</a></li>
<li><a href="#_3">统计表大小，用户空间大小</a></li>
<li><a href="#catalog">如何catalog 一个远程数据库</a></li>
<li><a href="#db2-on-mac">DB2 on mac 很难找！</a></li>
<li><a href="#db2-schema">db2 一个系统用户管理多个schema  .</a></li>
<li><a href="#db2-grant-schema">DB2 grant 无法针对 schema 授权</a></li>
</ul>
</li>
<li><a href="#mysql">MYSQL</a><ul>
<li><a href="#mysql-1040-too-many-connections">mysql : 1040 too many connections  的解决</a></li>
<li><a href="#mysql-full-outer-join">MYSQL 不支持 full outer join</a></li>
<li><a href="#mysql-except-or-minus">MYSQL 不支持 except or minus</a></li>
<li><a href="#mysql-a">mysql -A 参数</a></li>
<li><a href="#mysql-limit">mysql limit 的用法：</a></li>
<li><a href="#_4">关联技巧:恢复空表</a></li>
<li><a href="#mysqld">启动mysqld 的时候，一般加什么参数？</a></li>
<li><a href="#mysql_1">mysql 远程连接</a></li>
<li><a href="#except-minus-mysql">如果不能用 except , minus , mysql 如何比较两张表？</a></li>
<li><a href="#mysql-row">mysql 使用 row() 实现 多列比较</a></li>
<li><a href="#mysql-intersect">mysql 模拟 intersect  求差集</a></li>
<li><a href="#_5">远程数据库连接配置</a></li>
</ul>
</li>
<li><a href="#oracle">ORACLE</a><ul>
<li><a href="#start-with-connect-by-prior">start with ... connect by prior ...  用法</a></li>
</ul>
</li>
</ul>
</div>
        </nav>

        <p>记录数据库 安装、维护、开发与管理 的各种操作&amp;技巧。包含但不仅限于db2,oracle , mysql , sqlite...</p>

<h1 id="db2">DB2</h1>
<h2 id="_1">启动&amp;连接&amp;测试</h2>
<p>su - db2inst1</p>
<p>db2stop</p>
<p>db2start</p>
<p>db2 connect to sample</p>
<h2 id="_2">密码带特殊字符时，如果连接</h2>
<p>db2 'connect to sample user db2etl using "db2etl!QAZ"'</p>
<p>使用'' 包住connect 语句</p>
<p>使用 "" 包住 密码串。</p>
<p>但是！ 这种方法由于有' ' 的出现，导致变量不能被解释！这样的话，在shell中调用db2 就会遇到一些麻烦了！</p>
<h2 id="sql3001c-an-io-error">SQL3001C  An I/O error</h2>
<p>SQL3001C  An I/O error (reason = "sqlofopn -2079391743") occurred while  opening the output file.
报这个错的原因是路径不存在或路径没有写入权限。</p>
<h2 id="_3">统计表大小，用户空间大小</h2>
<p>从 SYSIBMADM.ADMINTABINFO  统计。</p>
<h2 id="catalog">如何catalog 一个远程数据库</h2>
<pre><code>Wills-MacBook-Pro:bin db2inst1$ db2 UNCATALOG DATABASE sample
DB20000I  The UNCATALOG DATABASE command completed successfully.
DB21056W  Directory changes may not be effective until the directory cache is 
refreshed.
Wills-MacBook-Pro:bin db2inst1$ db2 UNCATALOG node devnode   
DB20000I  The UNCATALOG NODE command completed successfully.
DB21056W  Directory changes may not be effective until the directory cache is 
refreshed.
Wills-MacBook-Pro:bin db2inst1$ db2 catalog tcpip node devnode remote 120.xx.xx.xx server 50000
DB20000I  The CATALOG TCPIP NODE command completed successfully.
DB21056W  Directory changes may not be effective until the directory cache is 
refreshed.
Wills-MacBook-Pro:bin db2inst1$ db2 catalog database sample at node devnode
DB20000I  The CATALOG DATABASE command completed successfully.
DB21056W  Directory changes may not be effective until the directory cache is 
refreshed.
Wills-MacBook-Pro:bin db2inst1$ db2 terminate
DB20000I  The TERMINATE command completed successfully.
Wills-MacBook-Pro:bin db2inst1$ db2 connect to sample
SQL30082N  Security processing failed with reason "3" ("PASSWORD MISSING").  
SQLSTATE=08001
Wills-MacBook-Pro:bin db2inst1$ db2 connect to sample user db2inst1       
Enter current password for db2inst1:

   Database Connection Information

 Database server        = DB2/LINUXX8664 9.7.0
 SQL authorization ID   = DB2INST1
 Local database alias   = SAMPLE

Wills-MacBook-Pro:bin db2inst1$ pwd
/Users/db2inst1/sqllib/bin
Wills-MacBook-Pro:bin db2inst1$ db2 "select count(0) from syscat.tables"

1          
-----------
        426

  1 record(s) selected.
</code></pre>
<h2 id="db2-on-mac">DB2 on mac 很难找！</h2>
<p>我找mac版的艰辛过程：
本来我打算在mac上安装一个client版的就行了，然后远程到云服务器上。google了半天，发现了一个v9.5版本的，但我的mac是10.10 ， 报错，不支持。</p>
<pre><code>DBI1189E There has been an attempt to use db2setup 
on an image for a platform that does not match the current platform 
'Darwin [x86_64]' on which it is being run.

Explanation:

Possible causes include:

- This DB2 install image is not valid for the current 
platform.

- The current platform is not supported by DB2.


User Response:

Install DB2 using the DB2 install image that corresponds 
with the current platform 'Darwin [x86_64]'.
</code></pre>
<p>没办法，只能装个最新的完整版的：</p>
<p>根据这个链接：</p>
<pre><code>https://www-01.ibm.com/marketing/iwm/iwm/web/pick.do?source=swg-db2expressc&amp;S_PKG=dlmacosx&amp;S_TACT=100KG31W&amp;lang=en_US
</code></pre>
<p>进入，注册，然后按要求填写，就可以得到一个下载地址。</p>
<p>还没安装，晚点再写安装&amp;使用体验。</p>
<h2 id="db2-schema">db2 一个系统用户管理多个schema  .</h2>
<p>-- 使用 db2inst1 操作</p>
<pre><code>db2 =&gt; create schema skma AUTHORIZATION  db2etl

DB20000I  The SQL command completed successfully.


db2 =&gt; select * from  skma.testskma

0 record(s) selected.
</code></pre>
<p>db2 =&gt; create table  skma.testskma(id integer)</p>
<p>DB20000I  The SQL command completed successfully.</p>
<p>--使用 db2etl 操作</p>
<pre><code>db2 =&gt; select * from skma.testskma;

SQL0551N  "DB2ETL" does not have the required authorization or privilege to perform operation "EXECUTE" on object "NULLID.SQLC2J23".  SQLSTATE=42501
</code></pre>
<p>解决：</p>
<pre><code>Resolving the problem:
The NULLID.SQLC2H21 package is created by db2clpcs.bnd, which is only in DB2 v9.7. The SQL0551N error may be seen if you have not ran any bind commands from a v9.7 client to the v9.1 or v9.5 database server.
</code></pre>
<p>参考：</p>
<pre><code>http://www-01.ibm.com/support/docview.wss?uid=swg21440573
</code></pre>
<p>-- 使用db2inst1 操作</p>
<pre><code>db2 =&gt; grant execute on package NULLID.SQLC2J23 to public

DB20000I  The SQL command completed successfully.
</code></pre>
<p>--使用db2etl 登陆：</p>
<pre><code>db2 =&gt; select * from  skma.testskma

0 record(s) selected.
</code></pre>
<h2 id="db2-grant-schema">DB2 grant 无法针对 schema 授权</h2>
<p>如果要对某个schema 下的所有表 做批量授权，需要 做批处理。因为db2没有可以直接对schema授权的方法。</p>
<p>具体方法如下：</p>
<pre><code>db2 -tnx "select distinct 'GRANT ALL ON TABLE '||
    '\"'||rtrim(tabschema)||'\".\"'||rtrim(tabname)||'\" TO USER winuser1;'
    from syscat.tables
    where tabschema = 'myschema' "  &gt;&gt; grants.sql

db2 -tvf grants.sql
</code></pre>
<h1 id="mysql">MYSQL</h1>
<h2 id="mysql-1040-too-many-connections">mysql : 1040 too many connections  的解决</h2>
<ol>
<li>修改 /etc/my.cnf ( 因系统安装环境而异 )</li>
<li>添加一行参数，例如1000：max_connections = 1000   </li>
<li>切换到 mysql 运维账户，我这里就是 su - mysql</li>
<li>重启： nohup mysqld 2&gt;&amp;1  &gt; mysql.out &amp;</li>
</ol>
<p>另外，
1. 有一个类似的参数，max_user_connections ， 网上说似乎无效，未验证。
2. 使用 show processlist 查看当前连接数。
3. 使用 show variables like "max_connections"  查看参数值。</p>
<h2 id="mysql-full-outer-join">MYSQL 不支持 full outer join</h2>
<p>解决办法：</p>
<pre><code>SELECT * FROM t1
LEFT JOIN t2 ON t1.id = t2.id
UNION
SELECT * FROM t1
RIGHT JOIN t2 ON t1.id = t2.id
</code></pre>
<h2 id="mysql-except-or-minus">MYSQL 不支持 except or minus</h2>
<h2 id="mysql-a">mysql -A 参数</h2>
<p>如果想快点进入mysql交互界面，就使用这个参数。否则，表多的时候，就要等好长时间。</p>
<pre><code>mysql -umeta -pxxxx metadata -h120.xx.xx.xx
</code></pre>
<p>Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A</p>
<p>No automatic rehashing. One has to use 'rehash' to get table and field completion. This gives a quicker start of mysql and disables rehashing on reconnect.</p>
<h2 id="mysql-limit">mysql limit 的用法：</h2>
<pre><code>mysql&gt; SELECT * FROM table LIMIT 5,10; // 检索记录行 6-15
</code></pre>
<p>limit m,n 解释:</p>
<p>m(5) -- 表示偏移量。也就是要skip掉m行。</p>
<p>n(10) --  表示从第m行之后，最大可以提取n行。</p>
<h2 id="_4">关联技巧:恢复空表</h2>
<pre><code>INSERT INTO ${PDM_SCH}.LI_COL
SELECT B.*
FROM ${PDM_SCH}.LI_COL_BAK B,
(
    SELECT COUNT(1) AS CNT
        FROM ${PDM_SCH}.LI_COL LIMIT 0,1
        ) O
        WHERE O.CNT=0;
</code></pre>
<h2 id="mysqld">启动mysqld 的时候，一般加什么参数？</h2>
<pre><code>ps -ef|grep -i mysql

结果：

   74    96     1   0 10:57AM ??         0:03.49 /usr/local/mysql/bin/mysqld --user=_mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --log-error=/usr/local/mysql/data/mysqld.local.err --pid-file=/usr/local/mysql/data/mysqld.local.pid
</code></pre>
<h2 id="mysql_1">mysql 远程连接</h2>
<pre><code>mysql -u -p -hxxx.xxx.xxx.xxx
</code></pre>
<p>可以添加 -A 参数， 让连接响应速度快一点</p>
<h2 id="except-minus-mysql">如果不能用 except , minus , mysql 如何比较两张表？</h2>
<h2 id="mysql-row">mysql 使用 row() 实现 多列比较</h2>
<p>在where 条件中，使用row() 函数，来枚举多列。</p>
<pre><code>mysql&gt; select host , user from user where row(host,user) not in (select '127.0.0.1' host , 'root' user from user );
</code></pre>
<h2 id="mysql-intersect">mysql 模拟 intersect  求差集</h2>
<p>由于mysql 不支持 intersect , 如果要求两个结果集的差集，就需要另辟蹊径.</p>
<p>方法1： 使用 union <em>all</em>  和 group by , having count(0) = 1 求出group by 之后，只有一条的记录。</p>
<pre><code>SELECT MIN (tbl_name) AS tbl_name, PK, column_list -- min / max make no difference 
FROM
 (
  SELECT ' source_table ' as tbl_name, S.PK, S.column_list
  FROM source_table AS S
  UNION ALL
  SELECT 'destination_table' as tbl_name, D.PK, D.column_list
  FROM destination_table AS D 
)  AS alias_table
GROUP BY PK, column_list
HAVING COUNT (0) = 1
ORDER BY PK
</code></pre>
<p>方法2:  使用 row() .. not in (select colList from table )  。 使用 not in 求字段差集。row() ， 在多字段的情况下使用。</p>
<pre><code>SELECT MIN (tbl_name) AS tbl_name, PK, column_list
FROM
 (
  SELECT ' source_table ' as tbl_name, S.PK, S.column_list
  FROM source_table AS S
  UNION ALL
  SELECT 'destination_table' as tbl_name, D.PK, D.column_list
  FROM destination_table AS D 
)  AS alias_table
GROUP BY PK, column_list
HAVING COUNT (*) = 1
ORDER BY PK
</code></pre>
<h2 id="_5">远程数据库连接配置</h2>
<ol>
<li>db2 </li>
</ol>
<p>我的工作电脑是macbook，如果要连接远程的db2，需要在本地做catalog . ibm官方网站上有 v10.1 的db2exc可以下载。可以用来做客户端或者一个简单的开发环境。mac os x 安装db2exc 要用root用户安装，安装之前要设置sysctl.conf参数，重启。然后最好给db2创建单独的用户db2inst1， 这样sqllib就会自动创建到db2inst1的目录下。使用db2icrt创建实例。使用db2sampl创建sample数据库。如果执行db2start时出现权限问题，就要给sqllib下的adm目录赋权。把原来赋给root的权限，chown到db2inst1 。 
当db2可以正常连接后，使用db2 catalog 归档远程数据库。注意：node 关键字是让你给节点起个名字，这个名字我们自己随便取，而不是服务器的特定值。先 归档 远程服务器节点，再归档数据库。端口用50000 五万。</p>
<ol>
<li>mysql </li>
</ol>
<p>连接远程的mysql，需要装本地mysql client 。 使用-h 参数指定远程服务器。使用-A 参数，降低连接时等待rehash的时间。</p>

<h1 id="oracle">ORACLE</h1>
<h2 id="start-with-connect-by-prior">start with ... connect by prior ...  用法</h2>
<p>表格式：sid|pid|level ; s for son , p for parent</p>
<p>start with pid=[截取的根节点nodeA] connect by prior sid = pid</p>
<p>[截取的根节点] : 当我们需要从哪个节点nodeA开始，就是让 pid 取为该开始节点值nodeA。</p>
<p>从 nodeA 开始， 取 [树的子节点son] 字段 ， 通过 prior 字段，取得son节点的祖先， 让 prior sid = pid ; 即 prior son = father ; 意思是 son的祖先＝father 。 更近一步：</p>
<p>prior sunzi = fuqin</p>
<p>prior fuqin = yeye</p>
<p>这样sunzi - fuqin - yeye 都关联起来了。</p>
<p><a href="http://mengya520.blog.51cto.com/1506880/334621">例子</a> ：</p>
<p>select ID, NAME, SYS_CONNECT_BY_PATH(pid,'/') as pid_path, SYS_CONNECT_BY_PATH(parent_name,'/') as parent_name
from test_parent1
start with pid=1 connect by prior id=pid;</p>
<p>如果 你写成 connect by prior pid = id , 那是不行的。 如果pid 还要取祖先，prior pid 的结果，就是爷爷了。 爷爷 ＝ 孙子 怎么行呢？乱套了！</p>


        <div class="sharethis-bottom">
          <span class='st_fblike_hcount' displayText='Facebook Like'></span>
          <span class='st_plusone_hcount' displayText='Google +1'></span>
          <span class='st_twitter_hcount' displayText='Tweet'></span>
          <span class='st_email_hcount' displayText='Email'></span>
        </div>
      </div><!-- /.entry-content -->
      <div class="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_identifier = "play-databases.html";
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//gitwillpoonimx3.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-69868761-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'gitwillpoonimx3';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>